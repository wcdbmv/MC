%% ГОСТ 7.32-2017
%% 5.1 Титульный лист
%%
%% 5.1.1 Титульный лист является первой страницей отчёта о НИР и служит источником информации, необходимой для обработки и поиска отчета в информационной среде.
%%
%% 5.1.2 На титульном листе приводят следующие сведения:
%%   а) наименование министерства (ведомства) или другого структурного образования, в систему которого входит организация-исполнитель;
%%   б) наименование (полное и сокращенное) организации — исполнителя НИР;
%%   в) индекс Универсальной десятичной классификации (УДК) по ГОСТ 7.90;
%%   г) номера, идентифицирующие отчёт:
%%     1) регистрационный номер НИР [1] (присваивает национальный орган научно-технической информации каждой страны при открытии темы НИР);
%%     2) регистрационный номер отчёта [2] (присваивает национальный орган научно-технической информации каждой страны при предоставлении отчетной документации);
%%   д) грифы согласования и утверждения отчёта, включая подпись руководителя организации с расшифровкой, печать организации и даты согласования и утверждения отчёта (дату указывают в интервале выполнения работы — для промежуточных отчётов и дату окончания — для заключительных отчётов);
%%   е) вид документа (отчёт о НИР);
%%   ж) наименование НИР;
%%   и) наименование отчёта;
%%   к) вид отчёта (заключительный, промежуточный);
%%   л) номер (шифр) научно-технической программы, темы;
%%   м) номер книги отчёта (при наличии нескольких книг отчёта);
%%   н) должность, учёную степень, учёное звание, подпись, инициалы и фамилию научного руководителя/руководителей НИР [3];
%%   п) место и год составления отчёта.
%%
%%     [1] В Российской Федерации регистрационный номер ЕГИСУ НИОКТР (Единая государственная информационная система учета результатов научно-исследовательских, опытно-конструкторских и технологических работ гражданского назначения) присваивает ЦИТиС, который осуществляет учет данных о научных исследованиях и разработках по всем областям.
%%     [2] В Российской Федерации регистрационный номер ИКРБС (Информационная карта реферативно-библиографических сведений) присваивает ЦИТиС, который осуществляет формирование и поддержку национального библиотечно-информационного фонда РФ в части открытых неопубликованных источников научной и технической информации - отчетов о НИР и т. д.
%%     [3] Для учреждений образования дополнительно аналогично вносятся подписи декана, заведующего кафедрой и других должностных лиц на усмотрение учреждений.
%%
%% 5.1.3 Если отчёт о НИР состоит из двух и более книг, каждая книга должна иметь свой титульный лист, соответствующий титульному листу первой книги и содержащий сведения, относящиеся к данной книге.
%%
%% 5.1.4 Титульный лист следует оформлять в соответствии с 6.10.
%% Примеры оформления титульных листов отчёта о НИР приведены в приложении А.
%%
%% 5.2 Список исполнителей
%%
%% 5.2.1 В список исполнителей должны быть включены фамилии и инициалы, должности, учёные степени, учёные звания и подписи руководителей НИР, ответственных исполнителей, исполнителей и соисполнителей, принимавших непосредственное участие в выполнении работы, с указанием их роли в подготовке отчёта.
%%
%% 5.2.2 Если отчёт выполнен одним исполнителем, его должность, учёную степень, учёное звание, фамилию и инициалы следует указывать на титульном листе отчёта.
%% В этом случае структурный элемент отчёта "СПИСОК ИСПОЛНИТЕЛЕЙ" не оформляют.
%%
%% 5.2.3 Основная задача нормоконтролера — проверка соблюдения норм и требований, установленных настоящим стандартом, соблюдение всех нормативных требований, соблюдения единообразия в оформлении структурных элементов и правил оформления отчёта о НИР.
%%
%% 5.2.4 Список исполнителей следует оформлять в соответствии с 6.11.
%% Примеры оформления списка исполнителей к отчёту о НИР приведены в приложении Б.


\RequirePackage{tabularx}
\RequirePackage{xifthen}

% Установка мета-данных выходного файла
\newcommand{\documentmeta}[4]
{
	\hypersetup{
		pdftitle={#1 #2 #3},
		pdfsubject={#4},
		pdfauthor={#2}
	}
}

% Cоздание полей
\RequirePackage[normalem]{ulem}
\RequirePackage{stackengine}
\newcommand{\longunderline}[1]
{
	\uline{#1\hfill\mbox{}}
}
\newcommand{\fixunderline}[3]
{
	$\underset{\text{#3}}{\text{\uline{\stackengine{0pt}{\hspace{#2}}{\text{#1}}{O}{c}{F}{F}{L}}}}$
}

% Создание горизонтальной линии
\makeatletter
\newcommand{\vhrulefill}[1]
{
	\leavevmode\leaders\hrule\@height#1\hfill \kern\z@
}
\makeatother

% Создание шапки титульной страницы
\newcommand{\titlepageheader}[2]
{
	\begin{wrapfigure}[7]{l}{0.14\linewidth}
		\vspace{3.4mm}
		\hspace{-8mm}
		\includegraphics[width=0.89\linewidth]{inc/img/bmstu-logo}
	\end{wrapfigure}

	{
		\singlespacing \small
		Министерство науки и высшего образования Российской Федерации \\
		Федеральное государственное бюджетное образовательное учреждение \\
		высшего образования \\
		«Московский государственный технический университет \\
		имени Н.~Э.~Баумана \\
		(национальный исследовательский университет)» \\
		(МГТУ им. Н.~Э.~Баумана) \\
	}

	\vspace{-4.2mm}
	\vhrulefill{0.9mm} \\
	\vspace{-7mm}
	\vhrulefill{0.2mm} \\
	\vspace{2.8mm}

	{
		\small\raggedright
		ФАКУЛЬТЕТ \hspace{7mm} «#1» \\
		\vspace{3.3mm}
		КАФЕДРА \hspace{13mm} «#2» \\
	}
}

% Установка заголовков отчета
\newcommand{\titlepagereporttitle}[4]
{
	\textbf{ОТЧЁТ} \\
	по #1 \\
	\ifthenelse{\isempty{#2}}{}{по курсу «#2» \\}
	\ifthenelse{\isempty{#3}}{}{на тему: «#3» \\}
	\ifthenelse{\isempty{#4}}{}{Вариант №~#4 \\}
}

% Создание поля студента
\newcommand{\titlepagestudent}[2]
{
	Студент \fixunderline{#1}{25mm}{(Группа)} &
	\fixunderline{}{40mm}{(Подпись, дата)} \vspace{1.3mm} &
	\fixunderline{#2}{40mm}{(Фамилия~И.~О.)} \\
}

% Создание прочих полей
\newcommand{\titlepageothers}[2]
{
	#1 &
	\fixunderline{}{40mm}{(Подпись, дата)} \vspace{1.3mm} &
	\fixunderline{#2}{40mm}{(Фамилия~И.~О.)} \\
}

% Установка исполнителей работы
\newcommand{\titlepageauthors}[7]
{
	{
		\small
		\begin{tabularx}{\textwidth}{@{}>{\hsize=.5\hsize}X>{\hsize=.25\hsize}X>{\hsize=.25\hsize}X@{}}
			\titlepagestudent{#1}{#2}
			\titlepageothers{#3}{#4}
			\ifthenelse{\isempty{#5}}{}{\titlepageothers{Консультант}{#5}}
			\ifthenelse{\isempty{#6}}{}{\titlepageothers{Консультант}{#6}}
			\ifthenelse{\isempty{#7}}{}{\titlepageothers{Нормоконтролер}{#7}}
		\end{tabularx}
	}
}

% Создание титульной страницы отчета
\newcommand{\makereporttitle}[9]
{
	\documentmeta{Отчёт}{#8}{#3 #4}{#5}

	\begin{titlepage}
		\centering

		\titlepageheader{#1}{#2}
		\vspace{15.8mm}

		\titlepagereporttitle{#3}{#4}{#5}{#6}
		\vfill

		\titlepageauthors{#7}{#8}{Преподаватель}{#9}{}{}{}
		\vspace{14mm}

		\textit{{\the\year} г.}
	\end{titlepage}

	\setcounter{page}{2}
}